

//Application OAuth Client ID
//ebb7dd9a7e7e441c9fdc


//Application OAuth Client Secret
//MiGCXEclxY0qMJ7AO4U8HTbp3pmx7rpOdT22kgwrAvY



// Application ID
// 7a47fc15-b630-45ae-9283-92d3a3630f33


//APIm Subscription Key
//b0b224caacfc4621b981c0aa0fe9d9a4



//code
//254967afe21b01965a6c4063fe5aefbc93909f0e385190df76ab9206e88ccbfc




//accessToken
//eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4OTMyOGViYTgyZmRlYzhlZTlmZGYwNDUzNWU2ODg3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE3MDA3NjA1MjUsImV4cCI6MTcwMDc2MjMyNSwiaXNzIjoiaHR0cHM6Ly9hcGkucGF5Y29yLmNvbS9zdHMvdjIvY29tbW9uIiwiYXVkIjoiZWJiN2RkOWE3ZTdlNDQxYzlmZGMiLCJjbGllbnRfaWQiOiJlYmI3ZGQ5YTdlN2U0NDFjOWZkYyIsInNpZCI6IjJhZmQ5NmVkLTFmOGEtZWUxMS1iODI1LWQ0ZjVlZjM0Yzc0NSIsImF1dGhfdGltZSI6MTcwMDc1ODAzMywidmVyIjoxLCJzdWIiOiI1OGYzMjhkNC00YTY2LTRlZjYtYTgzMy1kY2ZiN2U1ZjQ3MTUiLCJpZHAiOjMsInBheWNvcl91c2VyaWRlbnRpdHkiOiIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAiLCJwYXljb3JfdGltZW91dCI6MjQwLCJwYXljb3JfYnYiOiJKN1pUX2MzX3owLXdPRXFEekdMLTdRIiwicGF5Y29yX3ByaXZpbGVnZXMiOiJINHNJQUFBQUFBQUFDbDJVT2JJYk1ReEU3NklZQVltRmk3TmZMc2QyN3ZKSlZMcTdYL01uTXhNQVFoUExFR2hRNzlmWDE4L1hqNzg5ZDJ2OW53Ri9BNC94UitldFcyK0JiT3U5SWVDZXlFQ21kUWU3STV4NUlaeTd6b2tQNGdOLzRBLzhnVCt4azNwSlhPRXYvQ1BOcWVmVTg3N05xZVhVaXI0c0tpM210RmpOWWpzQzNtWFpKTXVTT3lYM1NXS1QzSFF3ZDBydWxCNld5ZG5FdHlYYmlweWlseUt2ZWxobHR5ck85a0NtamJsdGN1ZFpicXNoTVd4eHh6V3g4ZTBzMjZWNUJBMjJwTlBHOVZISFdxZ3B1R2kxTGNGMUJvZDFSblJtMUVOUUJjNG96aXpPTUhxZHFjcWFtdk9VbCs1N1g3TFdzWlRHRkZBcXhaMVIxSE14NWJTRUVnOGlTQk5GeWN0czRJbksvczJZS0dNK0tCRjNtRHZVSGU1Y0dXTFFSYUdMUXhlSkhzb1FsUzR1UFJTc1pqd1Z4eXhSWnhrVXA3WmNFM0pJb0hHRk1GYVV2S1VDVEo2TkVSeG5kNVNoU2ZvVW5JSmJhVnVWb1IrbFlMVWZzSU1pSkJvWm9RVU5OUjFxT3M2K2FZZ0JjeWpxeFpJbFptSXBUdlJvVjFDeTFFZCtyNloyVkNHbDlrdnRsK3FWbWk3RmxjZ3JOYTBGUXBGV3FSRDJBOFVOS2hXbnprc01qb1ozNkVQRE44K0xSL2YrOEtQZkY2OUxiMjNuTFBsNFpIZVlkeml1RUFLdmtFZHpnM05lSWMvbUNxdmRnbmtJVjhqTzM3OTcvNUtXN1lGdnhiVmtEL3lJZjlielovNnRVZTNtQTkrdXF4MTY0RWYrdU9ReisxLzh3YjAvbi85cS9WWGpBd1VBQUE9PSIsInBheWNvcl96aXAiOiJwYXljb3JfcHJpdmlsZWdlcyIsIm5hbWUiOiJSYXNoaWQgVGVzdCBJbnRlZ3JhdGlvbiIsImdpdmVuX25hbWUiOiJSYXNoaWQgVGVzdCIsImZhbWlseV9uYW1lIjoiSW50ZWdyYXRpb24iLCJlbWFpbCI6IklULUludGVncmF0aW9uc1N1cHBvcnRETEBwYXljb3IuY29tIiwiaXBhZGRyIjoiMTU0LjE5OC43Mi4yMDAiLCJqdGkiOiJhMzgyNzZkOWVhODBjYTA0NzU0OTM3YjA1NmY3ZTY1YiIsInNjb3BlIjpbImU3YmM0YzA0MjU4YWVlMTE4OTI1MDAwZDNhZDMwYzg5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdLCJwYXljb3JfY2xpZW50cyI6eyJDIjpbeyJDbGllbnRJZCI6MTQ5MDAxLCJDb21wYW55SWQiOjE5NDc1OSwiRW1wbG95ZWVVaWQiOm51bGwsIkNvbnRhY3RVaWQiOm51bGwsIkNwYUNvbnRhY3RVaWQiOm51bGwsIk9yZ2FuaXphdGlvbmFsVW5pdElkIjpudWxsLCJUZW5hbnRJZCI6bnVsbH1dfX0.d1j-4rpgK4T-J_GIrBmQmyFaB4Fs66K2kxnkJ--rgY77B_t8HGnhNdPn-eHqo3868V4u2Kl-zslWGbIwT1jFPvrWCBlP1ydhL_i4fzw93SmnQb70CThdbV6rWM29YQDLssnhB1-iNghXcsxv_p-LB460zxrK-KMapKuf5R7KmOoEKafsR8PtGiJut10zDMNAQsELaHQy61MmxRM6ni-QgXjjLJpw284fhXNjC12N4st0J30KnXUlkV_nWec6vab3wJuVThnRQWUIgxdb4IdZuNeLrcs3izNyau504otG_1qpxAylvTXQlEXeKzXMtwF9dDB7A1NFQjHOeUyt4XAkzQ



//refresh token
//180a22e2c41041d78de69b4991e61173b3c29c9f414e4695392a9b82ffec66b4


function myFunction() {

}



const ACCESS_TOKEN = "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4OTMyOGViYTgyZmRlYzhlZTlmZGYwNDUzNWU2ODg3IiwidHlwIjoiSldUIn0.eyJuYmYiOjE3MDA3NzA4NTQsImV4cCI6MTcwMDc3MjY1NCwiaXNzIjoiaHR0cHM6Ly9hcGkucGF5Y29yLmNvbS9zdHMvdjIvY29tbW9uIiwiYXVkIjoiNzIzNjE2ODE3ZTBhYmNhMTU2ODAiLCJjbGllbnRfaWQiOiI3MjM2MTY4MTdlMGFiY2ExNTY4MCIsInNpZCI6IjczNzUzYzkxLWYxZWEtNDA5NS1iY2JkLWI3M2E0MzMwZmQ2YiIsImF1dGhfdGltZSI6MTcwMDc2NDU1NiwidmVyIjoxLCJzdWIiOiI4NDBiZWI0Yy1mYzhiLTRjYjAtOTM0Mi1kMDJjMGZkMTAzYWQiLCJpZHAiOjMsInBheWNvcl91c2VyaWRlbnRpdHkiOiIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAiLCJwYXljb3JfdGltZW91dCI6MjQwLCJwYXljb3JfYnYiOiJxLVQ1c0dWQ2JVaWVjZjIwLVVkaWtRIiwicGF5Y29yX3ByaXZpbGVnZXMiOiJINHNJQUFBQUFBQUFDbDJVT1k0ZE1ReEU3ekt4QW5IVDRteGdPTFp6d3lmNW1MdjdsUno0cXdPeVZSTEo1bExTNitQejgvdkh0OStXdTNmNzA0QS9nV2Z4Uy92ZG12VkFkalByQ05nU0djaHM1bUIzaEQwdmhIM1gva0x3Q1h3Q204QW1zQWxza25VU003Rk5iQXFid3Fid0c5bWMyRTVzdDkyY3VFNWN4eWQ2dHJEVkludUxZajFuaThWNmM3YkJ1NURWc2hmQ2wzeVRYQk9mSkZZNm1IeVRmTk9qSmYvT3labDg5bTZGVDFGbjRWY1dyZEphRlh0N0lMT05HY2h1azNwbWVWc2RzV3FMSEZlTXRxaGhVY1BDWjAzT3NGMzQ3WWkyc3hEV3hicW91WWNVTzlZcEdYVldOSzFQUVVxenZ1aFZYOXBicC91c1RwOVBveTBFRmVYMDhqVHpkTkxxakVhcnFXR1JOVW9lQ21wTGNKMlZmT2tiU3Fka2l0TFlOSE9uQVNoTlZLUFdQRkE2cFpOTW5QRCtiL1lhUHQxRWlRS0hBNGNFaHdXSEJ1S0Jpd2d1SnJpbzRQUUVKUTh4d2tQR3FzZ1pMa3Ayb29tck5sZHRybDY1Nk9LcTBoa0FTcWVsQVBRYzdnbU93MEo1cUtldW5ycks5Nm05TGQrdDhMQUdKUS8xSUJnbUNwUG91SVg0SHFvOFZIa2M2aXJUVUM2aHhnWWpSbW1QUVRNT1FZMHNsa3cwdDRBNUp2cEJlVHhTM1VoVm1ZZitxa2drdEZUMk9VZ3RoKzZHR0pHS1V2cDVxWCtsL3BYNlYycGRLYUZTUXFWNEpSNlVXaWZTb21TU01vRjNLRVZKMlozckpoNlVwais0VVRhVTFkQS9waktkWjBYa3VibGJxOE1tMU9SRjRKMTRmZkhSOTRNSFFjOERuSzdOR2UvQ0RmT0c0eDNDbEhmSXZiNmdyUXZPK1E2NTNPK1FPM3ZCdWlDMzhFN2ovckZJL3NCWGNKSDdnUi8yejNqKzlML3ExcDE0NEN0ZGNmZUJILzdqOW9lTS96R2orY0dUL2ZyNitndDBEVllrMVFVQUFBPT0iLCJwYXljb3JfemlwIjoicGF5Y29yX3ByaXZpbGVnZXMiLCJpcGFkZHIiOiIyNDA0OjMxMDA6MTAwODpjZmZkOjYxYTA6ZDhiZjo4NGNiOmE4ZGYiLCJqdGkiOiJhOTAyMDQ2MDMyN2NiMDcxZTUxZjg5ODEzOWU5OWNjYyIsInNjb3BlIjpbIm9mZmxpbmVfYWNjZXNzIl0sImFtciI6WyJwd2QiXSwicGF5Y29yX2NsaWVudHMiOnsiQyI6W3siQ2xpZW50SWQiOjE0OTAwMSwiQ29tcGFueUlkIjoxOTQ3NTksIkVtcGxveWVlVWlkIjpudWxsLCJDb250YWN0VWlkIjpudWxsLCJDcGFDb250YWN0VWlkIjpudWxsLCJPcmdhbml6YXRpb25hbFVuaXRJZCI6bnVsbCwiVGVuYW50SWQiOm51bGx9XX19.PlcHTX8Jnl2ir1M3opeTsBi74VHIt1GJ9NRojnisOomCIeEpUmqwk5KgTts8PiKWiA1dvwETbjANdL76KrB9yHcB93cgwr6YoR1NfDt__057-waRe8CWHXMCtHUP-DubTy9S1jeajrW_PLIdQvS5XMg5g1G1WDlGFYdFpeu-ITedU2ZAIyxB6HL8gjuFebXkhoFjsnXK_PQpo4kCwR6naUys1b_HeqPk2xIqM0Ww37bTcBuh49HmSocu8Iclfsb89BFtq72DM4dRSDn2za5ykxaMQubn1BdEQNvBLR50XTcnVXybQKJLsOYnqU-oLZJdjlXp8Q0DFFlJMkw8fyyGSw"


function fetchData() {
  var url = "https://apis.paycor.com/v1/employees/<string>/punches?startDate=<dateTime>&endDate=<dateTime>&continuationToken=<string>";
  var headers = {
    "Accept": "application/json"
  };
  var options = {
    "method": "GET",
    "headers": headers,
    "muteHttpExceptions": true // Optional: set to true to catch HTTP exceptions
  };

  var response = UrlFetchApp.fetch(url, options);
  var result = response.getContentText();

  Logger.log(result); // Outputs the result to the Logs (View > Logs)
}



function fetchEmpHoursData() {


  let empId = 106569880062858
  // let url = "https://apis.paycor.com/v1/employees/" + empId + "/hours?subscription-key=" + SUBSCRIPTION_KEY

  //let url = "https://apis.paycor.com/v1/employees/" + empId + "/punches?subscription-key=" + SUBSCRIPTION_KEY

  //"https://apis.paycor.com/v1/employees/{employeeId}/punches"

  let url = "https://apis.paycor.com/v1/employees/148618406611300?"

  //let url = "https://apis.paycor.com/v1/employees/"+empId+"/punches?subscription-key="+SUBSCRIPTION_KEY+"&startdate=11-01-2023";

  //let url = "https://apis.paycor.com/v1/employees/<string>/punches?startDate=<dateTime>&endDate=<dateTime>&continuationToken=<string>";

  let payload = {
    //"Authorization": ACCESS_TOKEN,
    //"endDate": "11-04-2023"
    "subscription-key": SUBSCRIPTION_KEY
  };

  var headers = {
    "Accept": "application/json",
    //"Authorization" : "Bearer "+ACCESS_TOKEN,
    "Authorization": ACCESS_TOKEN,
    //"Ocp-Apim-Subscription-Key": SUBSCRIPTION_KEY
    //"subscription-key": "b9080358834840e8a1d8f37aaf277781"
  };
  var options = {
    "method": "GET",
    //"headers": headers,
    "headers": { "Authorization": "Bearer " + ACCESS_TOKEN, "Accept": "application/json" },
    //"payload": payload,
    //"muteHttpExceptions": true // Optional: set to true to catch HTTP exceptions

    //"contentType": "application/json",
    //"payload": payload,
  };

  var response = UrlFetchApp.fetch(url, options);
  Logger.log(response)
  var result = response.getContentText();

  Logger.log(result); // Outputs the result to the Logs (View > Logs)
}





function fetchPunchesDataC() {

  getNewTokenMain_()


  let ss = SpreadsheetApp.getActiveSpreadsheet();
  let apiDetailSheet = ss.getSheetByName(API_DETAILS_SHEET);
  let token = apiDetailSheet.getRange("B2").getValue();



  let tenantUrl = "https://apis.paycor.com/v1/tenants/" + TENANT_ID + "/employees"

  let headers = {
    "Authorization": "Bearer " + token,
    "Ocp-Apim-Subscription-Key": SUBSCRIPTION_KEY
  };

  let options = {
    "method": "GET",
    "headers": headers,
  };

  let employeeResponse = UrlFetchApp.fetch(tenantUrl, options);
  let empResult = employeeResponse.getContentText();
  let empResultObj = JSON.parse(empResult);


  let todayDate = new Date()

  let twoWeeksBeforeDate = new Date(new Date().setDate(new Date().getDate() - 80))
  twoWeeksBeforeDate = new Date(twoWeeksBeforeDate.getFullYear(), twoWeeksBeforeDate.getMonth(), twoWeeksBeforeDate.getDate())

  let weekEndDate = (todayDate.getMonth() + 1) + "-" + (todayDate.getDate()) + "-" + (todayDate.getFullYear())
  let weekStartDate = (twoWeeksBeforeDate.getMonth() + 1) + "-" + (twoWeeksBeforeDate.getDate()) + "-" + (twoWeeksBeforeDate.getFullYear())

  let allResults = []

  empResultObj.records.forEach(record => {
    //Logger.log(record)

    let url = "https://apis.paycor.com/v1/employees/" + record.employee.id + "/punches?startDate=" + weekStartDate + "&endDate=" + weekEndDate

    let response = UrlFetchApp.fetch(url, options);
    let result = response.getContentText();

    let resultObj = JSON.parse(result);
    // Logger.log(resultObj)
    //Logger.log(resultObj.records[0]);
    // Logger.log(resultObj.records[1]);

    resultObj.records.forEach(detail => {

      let location = "";
      if (detail.departmentName.toString().includes("BHM")) {
        location = "Trussville";
      } else if (detail.departmentName.toString().includes("GAD")) {
        location = "Gadsden";
      } else if (detail.departmentName.toString().includes("OXF")) {
        location = "Oxford";
      }

      allResults.push([record.firstName, record.middleName, record.lastName, detail.departmentName, location, new Date(detail.displayDate), detail.earningCode, detail.punchIn, detail.punchOut, detail.hourAmount])

    })


  })




  let punchesSheet = ss.getSheetByName("Punches");

  punchesSheet.getRange(2, 1, allResults.length, allResults[0].length).setValues(allResults)



}




function getnewTokenTemp() {
  getNewTokenMain_()
}








